<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VibeVote Final ‚ú®</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* --- 1. CORE STYLES --- */
        :root {
            --bg-gradient: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --primary: #8b5cf6;
            --secondary: #ec4899;
            --danger: #ef4444;
            --warning: #f59e0b; /* Warna Kuning Peringatan */
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --success: #10b981;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Space Grotesk', sans-serif; -webkit-tap-highlight-color: transparent; }

        body {
            background: var(--bg-gradient);
            color: var(--text-main);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        /* --- 2. LAYOUT & UTILS --- */
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding-bottom: 90px;
        }

        .hidden { display: none !important; }

        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            animation: slideUp 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        h1, h2 { font-weight: 700; letter-spacing: -0.5px; }
        h1 { margin-bottom: 5px; font-size: 1.8rem; }
        .subtitle { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1.5rem; }

        /* --- 3. FORM ELEMENTS --- */
        input[type="text"], input[type="password"] {
            width: 100%; background: rgba(0,0,0,0.3);
            border: 1px solid var(--glass-border);
            border-radius: 12px; padding: 12px;
            color: white; outline: none; margin-bottom: 10px;
            transition: 0.3s;
        }
        input[type="text"]:focus, input[type="password"]:focus { border-color: var(--primary); }
        
        .input-error { border-color: var(--danger) !important; animation: shake 0.3s; }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } 100% { transform: translateX(0); } }

        .btn {
            width: 100%; padding: 12px; border: none; border-radius: 12px;
            font-weight: 700; cursor: pointer; transition: 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn:active { transform: scale(0.97); }
        .btn-primary { background: linear-gradient(90deg, var(--primary), var(--secondary)); color: white; }
        .btn-danger { background: rgba(239, 68, 68, 0.2); color: var(--danger); border: 1px solid var(--danger); }
        .btn-outline { background: transparent; border: 1px dashed var(--glass-border); color: var(--text-muted); }
        
        .icon-btn { padding: 8px; border-radius: 8px; border: none; cursor: pointer; color: white; }
        .edit-btn { background: rgba(139, 92, 246, 0.2); color: var(--primary); }
        .del-btn { background: rgba(239, 68, 68, 0.2); color: var(--danger); }

        /* --- 4. NEW: INFO BANNER (WARNING) --- */
        .info-banner {
            background: rgba(245, 158, 11, 0.15); /* Orange Transparan */
            border: 1px solid rgba(245, 158, 11, 0.3);
            color: #fcd34d; /* Text Kuning Terang */
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 0.85rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            line-height: 1.4;
        }
        .info-banner i { font-size: 1.1rem; }

        /* --- 5. VOTING INTERFACE --- */
        .vote-option {
            position: relative;
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--glass-border);
            border-radius: 14px; padding: 15px; margin-bottom: 10px;
            cursor: pointer; overflow: hidden;
            display: flex; justify-content: space-between; align-items: center;
        }
        .vote-option.selected { border-color: var(--success); background: rgba(16, 185, 129, 0.1); }
        .vote-option.disabled { opacity: 0.6; cursor: not-allowed; pointer-events: none; }
        
        .progress-bar {
            position: absolute; left: 0; top: 0; bottom: 0;
            background: rgba(139, 92, 246, 0.2); z-index: 0;
            transition: width 0.6s ease; width: 0%;
        }
        .option-content { position: relative; z-index: 2; width: 100%; display: flex; justify-content: space-between; }

        /* --- 6. NAVIGATION & MODALS --- */
        .bottom-nav {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(20px);
            padding: 10px; border-radius: 50px; border: 1px solid var(--glass-border);
            display: flex; gap: 10px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); z-index: 100;
        }
        .nav-item {
            padding: 10px 20px; border-radius: 40px; color: var(--text-muted);
            cursor: pointer; font-size: 0.9rem; font-weight: 600; transition: 0.3s;
        }
        .nav-item.active { background: var(--primary); color: white; }

        .fab {
            position: fixed; bottom: 100px; right: 20px;
            width: 56px; height: 56px; border-radius: 50%;
            background: var(--secondary); color: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; box-shadow: 0 4px 20px rgba(236, 72, 153, 0.5);
            cursor: pointer; border: none; z-index: 99;
            transition: transform 0.2s;
        }
        .fab:active { transform: scale(0.9); }

        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
            z-index: 150; display: flex; align-items: center; justify-content: center;
        }
        .modal-content {
            width: 90%; max-width: 350px;
            background: #1e1b4b; 
            border: 1px solid var(--glass-border);
            border-radius: 24px; padding: 2rem;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

    </style>
</head>
<body>

    <div class="container">
        <header style="text-align: center; margin-bottom: 20px; margin-top: 10px;">
            <div style="font-size: 3rem; margin-bottom: 10px;">‚ú®</div>
            <h1>VibeVote Hub</h1>
            <p class="subtitle" id="page-subtitle">Pilih topik & berikan suaramu.</p>
        </header>

        <section id="user-view" class="view-section">
            <div id="user-poll-list"></div>
            <div id="empty-state-user" class="glass-card hidden" style="text-align: center;">
                <p>Belum ada voting aktif nih üò¥</p>
            </div>
        </section>

        <section id="admin-view" class="view-section hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h2 style="font-size: 1.2rem;">Daftar Voting</h2>
                <button onclick="adminLogout()" style="background:none; border:none; color: var(--danger); cursor:pointer; font-size: 0.9rem;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
            <div id="admin-poll-list"></div>
            <button class="fab" onclick="showCreateModal()">+</button>
        </section>

        <section id="voting-room" class="view-section hidden">
            <button onclick="goBack()" class="btn btn-outline" style="margin-bottom: 15px; width: auto; padding: 8px 15px;">‚Üê Kembali</button>
            
            <div class="glass-card">
                <h2 id="room-title" style="margin-bottom: 5px;">Judul Voting</h2>
                
                <div id="vote-warning" class="info-banner hidden">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span><strong>Penting:</strong> Kamu hanya bisa memilih 1 kali. Pilihan tidak dapat diganti setelah diklik!</span>
                </div>

                <p class="subtitle" id="room-status" style="margin-bottom: 15px;">Silakan pilih:</p>
                <div id="room-options"></div>
            </div>
        </section>
    </div>

    <div id="login-modal" class="modal-overlay hidden">
        <div class="modal-content glass-card">
            <div style="text-align: center; margin-bottom: 1.5rem;">
                <i class="fas fa-lock" style="font-size: 2rem; color: var(--primary); margin-bottom: 10px;"></i>
                <h3>Admin Access</h3>
                <p style="font-size: 0.8rem; color: var(--text-muted);">Masukkan sandi rahasia.</p>
            </div>
            <input type="text" id="login-user" placeholder="Username">
            <input type="password" id="login-pass" placeholder="Password">
            <button class="btn btn-primary" onclick="attemptLogin()" style="margin-top: 10px;">Masuk</button>
            <button class="btn btn-outline" onclick="closeLoginModal()" style="margin-top: 10px;">Batal</button>
        </div>
    </div>

    <div id="create-modal" class="modal-overlay hidden">
        <div class="modal-content glass-card">
            <h3 style="margin-bottom: 15px;">Buat / Edit Voting üìù</h3>
            <input type="text" id="input-title" placeholder="Judul (Contoh: Liburan kemana?)">
            <div id="input-options-container">
                <input type="text" class="input-opt" placeholder="Opsi 1">
                <input type="text" class="input-opt" placeholder="Opsi 2">
            </div>
            <button class="btn btn-outline" onclick="addInputOption()" style="margin-bottom: 15px;">+ Tambah Opsi</button>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-danger" onclick="closeCreateModal()">Batal</button>
                <button class="btn btn-primary" onclick="savePoll()">Simpan</button>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchView('user')" id="nav-user">User Lobby</div>
        <div class="nav-item" onclick="switchView('admin')" id="nav-admin">Admin Panel</div>
    </nav>

    <script>
        // --- CONFIG ---
        const AUTH = { user: "admin", pass: "123" };

        // --- STATE ---
        let polls = JSON.parse(localStorage.getItem('vibevote_polls')) || [];
        let votedHistory = JSON.parse(localStorage.getItem('vibevote_history')) || [];
        let isAdminLoggedIn = false;
        let editingId = null;

        // --- NAVIGATION & SECURITY ---
        function switchView(viewName) {
            if (viewName === 'admin') {
                if (!isAdminLoggedIn) {
                    document.getElementById('login-modal').classList.remove('hidden');
                    return;
                }
            }

            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));

            if(viewName === 'user') {
                document.getElementById('user-view').classList.remove('hidden');
                document.getElementById('nav-user').classList.add('active');
                document.getElementById('page-subtitle').innerText = "Pilih topik & berikan suaramu.";
                renderUserList(); 
            } else if (viewName === 'admin') {
                document.getElementById('admin-view').classList.remove('hidden');
                document.getElementById('nav-admin').classList.add('active');
                document.getElementById('page-subtitle').innerText = "Kelola data voting.";
                renderAdminList();
            } else if (viewName === 'room') {
                document.getElementById('voting-room').classList.remove('hidden');
                document.getElementById('page-subtitle').innerText = "Tap opsi untuk memilih!";
            }
        }

        // --- AUTH ---
        function attemptLogin() {
            const u = document.getElementById('login-user');
            const p = document.getElementById('login-pass');
            if (u.value === AUTH.user && p.value === AUTH.pass) {
                isAdminLoggedIn = true;
                closeLoginModal();
                switchView('admin');
                u.value = ""; p.value = "";
                u.classList.remove('input-error'); p.classList.remove('input-error');
            } else {
                u.classList.add('input-error'); p.classList.add('input-error');
                setTimeout(() => { u.classList.remove('input-error'); p.classList.remove('input-error'); }, 500);
            }
        }

        function closeLoginModal() {
            document.getElementById('login-modal').classList.add('hidden');
            if(!isAdminLoggedIn) {
                document.getElementById('nav-user').classList.add('active');
                document.getElementById('nav-admin').classList.remove('active');
            }
        }

        function adminLogout() {
            isAdminLoggedIn = false;
            switchView('user');
            alert("Berhasil logout!");
        }

        function goBack() { switchView('user'); }

        // --- CORE LOGIC ---
        function saveToLocal() {
            localStorage.setItem('vibevote_polls', JSON.stringify(polls));
            localStorage.setItem('vibevote_history', JSON.stringify(votedHistory));
            renderAll();
        }

        function renderAll() { renderAdminList(); renderUserList(); }

        function renderAdminList() {
            const list = document.getElementById('admin-poll-list');
            list.innerHTML = "";
            if(polls.length === 0) list.innerHTML = `<div class="glass-card" style="text-align:center; color: #666;">Belum ada data.</div>`;
            polls.forEach(poll => {
                const totalVotes = poll.options.reduce((acc, curr) => acc + curr.votes, 0);
                const item = document.createElement('div');
                item.className = 'glass-card poll-item';
                item.innerHTML = `
                    <div class="poll-info">
                        <h3>${poll.title}</h3>
                        <span>${poll.options.length} Opsi ‚Ä¢ ${totalVotes} Votes</span>
                    </div>
                    <div class="poll-actions">
                        <button class="icon-btn edit-btn" onclick="openEditMode(${poll.id})"><i class="fas fa-pen"></i></button>
                        <button class="icon-btn del-btn" onclick="deletePoll(${poll.id})"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        function renderUserList() {
            const list = document.getElementById('user-poll-list');
            const emptyState = document.getElementById('empty-state-user');
            list.innerHTML = "";
            if(polls.length === 0) { emptyState.classList.remove('hidden'); return; } 
            else { emptyState.classList.add('hidden'); }

            polls.forEach(poll => {
                const hasVoted = votedHistory.includes(poll.id);
                const statusIcon = hasVoted ? "‚úÖ Done" : "üî• Vote";
                const totalVotes = poll.options.reduce((acc, curr) => acc + curr.votes, 0);
                const card = document.createElement('div');
                card.className = 'glass-card';
                card.style.cursor = 'pointer';
                card.onclick = () => openVotingRoom(poll.id);
                card.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <h3 style="margin-bottom:5px;">${poll.title}</h3>
                            <span style="font-size:0.8rem; color: #94a3b8;">${totalVotes} suara masuk</span>
                        </div>
                        <div style="font-size:0.8rem; background:rgba(255,255,255,0.1); padding:5px 10px; border-radius:20px;">
                            ${statusIcon}
                        </div>
                    </div>
                `;
                list.appendChild(card);
            });
        }

        function openVotingRoom(id) {
            const poll = polls.find(p => p.id === id);
            if(!poll) return;

            switchView('room');
            document.getElementById('room-title').innerText = poll.title;
            const container = document.getElementById('room-options');
            container.innerHTML = "";

            const hasVoted = votedHistory.includes(id);
            const totalVotes = poll.options.reduce((acc, curr) => acc + curr.votes, 0);

            // LOGIC WARNING BANNER
            if (!hasVoted) {
                document.getElementById('vote-warning').classList.remove('hidden');
                document.getElementById('room-status').innerText = "Silakan pilih salah satu:";
            } else {
                document.getElementById('vote-warning').classList.add('hidden');
                document.getElementById('room-status').innerText = "Terima kasih! Kamu sudah memilih.";
            }

            poll.options.forEach((opt, idx) => {
                let percent = totalVotes === 0 ? 0 : Math.round((opt.votes / totalVotes) * 100);
                const btn = document.createElement('div');
                let className = 'vote-option';
                if(hasVoted) className += ' disabled';
                
                btn.className = className;
                btn.onclick = () => castVote(id, idx);
                btn.innerHTML = `
                    <div class="progress-bar" style="width: ${hasVoted ? percent : 0}%"></div>
                    <div class="option-content">
                        <span>${opt.name}</span>
                        <span>${hasVoted ? percent + '%' : ''}</span>
                    </div>
                `;
                container.appendChild(btn);
            });
        }

        function castVote(pollId, optionIdx) {
            if(votedHistory.includes(pollId)) return;
            const pollIndex = polls.findIndex(p => p.id === pollId);
            polls[pollIndex].options[optionIdx].votes++;
            votedHistory.push(pollId);
            saveToLocal();
            openVotingRoom(pollId); // Refresh tampilan room
        }

        // --- CRUD ---
        function showCreateModal() {
            editingId = null;
            document.getElementById('input-title').value = "";
            document.getElementById('input-options-container').innerHTML = `
                <input type="text" class="input-opt" placeholder="Opsi 1">
                <input type="text" class="input-opt" placeholder="Opsi 2">
            `;
            document.getElementById('create-modal').classList.remove('hidden');
        }

        function openEditMode(id) {
            const poll = polls.find(p => p.id === id);
            editingId = id;
            document.getElementById('input-title').value = poll.title;
            const container = document.getElementById('input-options-container');
            container.innerHTML = "";
            poll.options.forEach(opt => {
                container.innerHTML += `<input type="text" class="input-opt" value="${opt.name}">`;
            });
            document.getElementById('create-modal').classList.remove('hidden');
        }

        function addInputOption() {
            const container = document.getElementById('input-options-container');
            container.insertAdjacentHTML('beforeend', `<input type="text" class="input-opt" placeholder="Opsi Baru">`);
        }

        function closeCreateModal() { document.getElementById('create-modal').classList.add('hidden'); }

        function savePoll() {
            const title = document.getElementById('input-title').value;
            const optInputs = document.querySelectorAll('.input-opt');
            let opts = [];
            optInputs.forEach(input => {
                if(input.value.trim()) opts.push({ name: input.value, votes: 0 });
            });
            if(!title || opts.length < 2) { alert("Data tidak lengkap!"); return; }

            if(editingId) {
                const index = polls.findIndex(p => p.id === editingId);
                let oldOptions = polls[index].options;
                let newOptions = opts.map((newOpt, i) => {
                    return { name: newOpt.name, votes: (oldOptions[i] ? oldOptions[i].votes : 0) };
                });
                polls[index].title = title;
                polls[index].options = newOptions;
            } else {
                polls.push({ id: Date.now(), title: title, options: opts });
            }
            saveToLocal();
            closeCreateModal();
            renderAdminList();
        }

        function deletePoll(id) {
            if(confirm("Hapus voting ini selamanya?")) {
                polls = polls.filter(p => p.id !== id);
                saveToLocal();
                renderAdminList();
            }
        }

        // --- INIT ---
        renderAll();
        switchView('user');
    </script>
</body>
</html>
